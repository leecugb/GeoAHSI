# pymica (python for mineral identification and characterization using imaging spectrometer data)
成像光谱仪测量了地球表面反射的太阳辐射在众多窄通道的分布情况，为每个像素生成一条反射光谱。通过这些反射光谱可以解析识别由电子状态跃迁或化学分子键振动引起的吸收光谱特征。分析吸收光谱特征的位置和形状能够获取地表矿物的成分信息（Clark and others, 2003）。绘制这些矿物的空间分布需要矿物反射率光谱的原位知识，以及一个能够最大限度地降低错误识别风险的将原位知识与遥感探测的地表反射率相匹配的系统，也即矿物填图算法。高光谱矿物填图的方法很多，最经典地，可归纳为两类：以混合调制匹配滤波（沙漏法）为代表的端元组分提取及匹配算法，以Tetracorder算法为代表的基于专家规则的多光谱特征加权拟合算法。前者对于大范围高光谱遥感矿物填图应用而言，缺陷是显而易见的：一方面每景影像都需要单独执行端元提取算法（PPI、ATGP、FIPPI、NFINDR等），虽然该方法在理论上可提取出优于光谱库或实验室端元组分，但却计算量巨大，而且提取的端元需要专家经验确定对应矿物（地物）类别，这给工程化应用带来巨大挑战；另一方面，波谱匹配往往采取整体谱形能量最小化约束算法（MF、CEM等），对噪声很敏感，难以有效顾及弱诊断吸收特征（绿泥石/绿帘石2250nm、明矾石1500nm等），这对于信噪比相对较差的航天高光谱遥感影像来说，大大降低了适用性。自20世纪90年代起由Roger N. Clark等发展起来的Tetracorder矿物识别专家系统不断成熟完善（Clark等，2003），为高光谱矿物识别提供了强大的算法框架和基础工具。Tetracorder算法通过高光谱影像光谱直接与光谱库里标准物质的光谱做匹配来识别像元物质成分，但做出了若干项重要改进。一是光谱识别算法仅仅使用了光谱吸收特征区间（尤其是诊断吸收特征），而不是整体波谱，大大降低了影像噪声的影响；二是引入竞争机制，通过比较某观测波谱与各参考物质波谱的相似性来确定最佳识别对象；三是引入吸收特征的反射率、局部斜率和吸收深度等参数阈值作为约束，降低虚假检测；四是根据光谱机理不同，采取分区分析的策略，使得它在不必执行光谱解混运算的情况下支持多物质识别；五是它允许返回未识别的结果。简而言之，Tetracorder建立在这样一个认识之上，即在整个波谱范围内，仅仅物质的诊断光谱区间是有意义的。正因为如此，它支持在同一条观测波谱上识别出多种物质。它通过定量比较观测波谱与一组光谱相似的参考物质的相似性度量来降低虚假检测，通过引入附加光谱参数约束来降低光谱形状匹配算法带来的偶然虚假检测。最后，它并不强迫必须为观测波谱给出识别结果。上述特性使得它在大范围工程化应用高光谱矿物填图方面具有天然优势：优良的抗噪声能力、无需人工干预（运行中）、填图一致性。Kokaly等（2011）在Tetracorder算法框架的基础上对光谱拟合过程进行了改进，而且增加了用户对光谱诊断特征的权重、匹配阈值的调控余地，提出了物质识别和特征描述算法（Material Identification and Characterization Algorithm, MICA）。

从2018年起，国内陆续发射了高分五号卫星（2018.05）、资源一号02D星（2019.09）、高分五号02星（2021.09）、资源一号02E星（2021.12）、高分五号01A（2022.12）等一系列技术参数达到国际领先水平的高光谱遥感卫星，为国内正如火如荼展开的新一轮找矿突破战略行动提供了海量优质高光谱遥感数据，彻底解决了国内高光谱遥感矿产勘查应用“无米下锅”的窘境。自2022年国内新一轮找矿突破战略行动全面启动以来，国家加大了对本土关键矿产资源的勘查力度，在地质调查、研究程度普遍较高的重要成矿区（带）如何取得新的找矿突破，新技术、新方法的应用是关键！

大范围高光谱矿物填图属于计算密集型工作，算法研发及工程化填图应用均需要运行高效的软件工具的支持。对于Tetracorder算法，目前Roger N. Clark给出的唯一实现工具，核心部分使用了fortran、ratfor和C语言来实现（阅读难度大），辅助功能（影像可视化）则使用了davinci和shell脚本，近二十万行代码，调试和优化较为困难。Kokaly提供的MICA算法实现是内嵌于基于IDL开发的PRISM(以ENVI插件方式运行)中的，其运行环境依赖商业授权，且运行效率并不是很高（一景高分五号影像处理超过一个小时，惠普Z840实测），给大规模应用带来了困扰，且并未开放源代码。本次工作使用开源地理空间信息技术，在Tetracorder算法框架下，重新编写了高光谱矿物填图软件工具pymica，大大提高了运行效率，较之于PRISM速度提高了20倍。




![屏幕截图 2023-06-28 190133](https://github.com/leecugb/pymica/assets/38849659/2a9aa593-e85f-4d86-8dd1-7ac3eb2671e0)
